#!/bin/bash

echo "ğŸµ GrooveScribe Audio Debug Helper"
echo "=================================="

# Deploy to MAMP
echo "ğŸ“¦ Deploying to MAMP..."
if [ -f "./deploy_to_mamp.sh" ]; then
    ./deploy_to_mamp.sh
    if [ $? -eq 0 ]; then
        echo "âœ… Deploy successful!"
    else
        echo "âŒ Deploy failed!"
        exit 1
    fi
else
    echo "âŒ deploy_to_mamp.sh not found!"
    exit 1
fi

echo ""
echo "ğŸ” Debug Instructions:"
echo "====================="
echo ""
echo "1. Open your web browser and go to your MAMP server URL"
echo "   (typically http://localhost:8888/GrooveScribe/ or similar)"
echo ""
echo "2. Open the browser's Developer Console (F12 â†’ Console tab)"
echo ""
echo "3. Look for these messages in the console:"
echo "   ğŸµ Debug Audio System Loading..."
echo "   ğŸ”§ Creating DebugAudioManager..."
echo "   âœ… Successfully loaded: [sample name]"
echo "   ğŸ‰ Debug audio system initialized successfully!"
echo ""
echo "4. Run these commands in the console to diagnose:"
echo "   getDetailedAudioStatus()           - Complete system status"
echo "   getAudioInitLog()                  - Initialization log"
echo "   testDrumSound(35)                  - Test kick drum"
echo "   testDrumSound(38)                  - Test snare drum"
echo "   testDrumSound(47)                  - Test tom 2 (previously broken)"
echo ""
echo "5. Also test the dedicated test page:"
echo "   Go to: test_drum_sounds.html"
echo "   Click 'Show Debug Log' to see detailed information"
echo "   Click 'Run All Tests' for comprehensive testing"
echo ""
echo "6. Expected Success Rate:"
echo "   If working properly: 80-90%+ success rate"
echo "   If still broken: ~19% success rate (legacy fallback)"
echo ""
echo "7. Common Issues to Look For:"
echo "   - 404 errors loading MP3 files from soundfont/NewDrumSamples/MP3/"
echo "   - CORS errors (shouldn't happen with MAMP)"
echo "   - Audio context errors"
echo "   - Missing initialization messages"
echo ""
echo "ğŸ“Š Expected Console Output (if working):"
echo "========================================="
echo "ğŸµ Debug Audio System Loading..."
echo "ğŸµ [timestamp] Starting initialization..."
echo "ğŸµ [timestamp] Current location: http://localhost:8888/..."
echo "ğŸµ [timestamp] Testing base path access: soundfont/NewDrumSamples/MP3/Kick.mp3"
echo "ğŸµ [timestamp] Base path test response: 200 OK"
echo "ğŸµ [timestamp] Starting to load [X] audio samples from: soundfont/NewDrumSamples/MP3/"
echo "ğŸµ [timestamp] Loading kick: soundfont/NewDrumSamples/MP3/Kick.mp3"
echo "ğŸµ [timestamp] âœ… Successfully loaded: kick"
echo "... (similar for all samples)"
echo "ğŸµ [timestamp] Audio loading complete: [X]/[X] samples loaded successfully"
echo "ğŸµ [timestamp] Initialization completed successfully! Loaded [X]/[X] samples"
echo "ğŸ‰ Debug audio system initialized successfully!"
echo ""
echo "ğŸš¨ If you see errors or missing samples, that's the root cause!"
echo ""
echo "Happy debugging! ğŸµ" 