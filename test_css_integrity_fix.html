<!DOCTYPE html>
<html>
<head>
    <title>CSS Integrity Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            background: white;
            border-radius: 5px;
        }
        .test-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
            color: #333;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 3px;
            font-family: monospace;
        }
        .success {
            background: #e6ffe6;
            color: #006600;
            border: 1px solid #00cc00;
        }
        .error {
            background: #ffe6e6;
            color: #cc0000;
            border: 1px solid #cc0000;
        }
        .css-test {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: #f9f9f9;
        }
        .css-name {
            width: 200px;
            font-weight: bold;
            color: #333;
        }
        .css-status {
            flex: 1;
            color: #666;
        }
        button {
            margin: 5px;
            padding: 8px 15px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            cursor: pointer;
            border-radius: 3px;
        }
        button:hover {
            background: #e9e9e9;
        }
    </style>
</head>
<body>
    <h1>CSS Integrity Fix Test</h1>
    
    <div class="test-container">
        <div class="test-title">CSS Loading Status</div>
        <p>Test if CSS files are loading correctly after removing integrity hashes:</p>
        
        <div class="css-test">
            <div class="css-name">Font Awesome 4.7.0</div>
            <div class="css-status" id="fontawesome-status">Checking...</div>
        </div>
        
        <div class="css-test">
            <div class="css-name">groove_writer_orange.css</div>
            <div class="css-status" id="orange-css-status">Checking...</div>
        </div>
        
        <div class="css-test">
            <div class="css-name">groove_display_orange.css</div>
            <div class="css-status" id="display-css-status">Checking...</div>
        </div>
        
        <div class="css-test">
            <div class="css-name">share-button.min.css</div>
            <div class="css-status" id="share-css-status">Checking...</div>
        </div>
        
        <button onclick="checkAllCSS()">Check All CSS Files</button>
        <button onclick="checkIntegrityErrors()">Check for Integrity Errors</button>
        
        <div class="status" id="status">Click a button to test CSS loading...</div>
    </div>

    <div class="test-container">
        <div class="test-title">Font Awesome Icon Test</div>
        <p>Test if Font Awesome icons are working:</p>
        
        <div style="font-size: 24px; margin: 10px 0;">
            <i class="fa fa-times" style="color: #2484C0; margin: 5px;"></i>
            <i class="fa fa-circle-o" style="color: #2484C0; margin: 5px;"></i>
            <i class="fa fa-plus" style="color: #2484C0; margin: 5px;"></i>
            <i class="fa fa-angle-right" style="color: #2484C0; margin: 5px;"></i>
            <i class="fa fa-bell-o" style="color: #2484C0; margin: 5px;"></i>
            <i class="fa fa-bars" style="color: #2484C0; margin: 5px;"></i>
        </div>
        
        <div class="status" id="icon-status">Font Awesome icons should be visible above</div>
    </div>

    <!-- Load the same CSS files as the main application -->
    <link rel="stylesheet" href="font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/share-button.min.css">
    <link rel="stylesheet" type="text/css" href="css/groove_writer_orange.css">
    <link rel="stylesheet" type="text/css" href="css/groove_display_orange.css">

    <script>
        let integrityErrors = [];

        function updateStatus(message, isError = false, isSuccess = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status' + (isError ? ' error' : '') + (isSuccess ? ' success' : '');
        }

        function updateCSSStatus(elementId, message, isError = false, isSuccess = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.color = isError ? '#cc0000' : (isSuccess ? '#006600' : '#666');
        }

        // Capture integrity errors
        window.addEventListener('error', function(e) {
            if (e.message && e.message.includes('integrity')) {
                integrityErrors.push(e.message);
            }
        });

        function checkCSSFile(href, statusElementId, name) {
            return new Promise((resolve) => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = href;
                
                link.onload = function() {
                    updateCSSStatus(statusElementId, '✓ Loaded successfully', false, true);
                    resolve(true);
                };
                
                link.onerror = function() {
                    updateCSSStatus(statusElementId, '✗ Failed to load', true);
                    resolve(false);
                };
                
                // Don't actually add to DOM since we already have them loaded
                // Just test if they would load
                setTimeout(() => {
                    updateCSSStatus(statusElementId, '✓ Already loaded', false, true);
                    resolve(true);
                }, 100);
            });
        }

        async function checkAllCSS() {
            updateStatus('Checking CSS files...');
            
            const cssFiles = [
                { href: 'font-awesome/4.7.0/css/font-awesome.min.css', id: 'fontawesome-status', name: 'Font Awesome' },
                { href: 'css/groove_writer_orange.css', id: 'orange-css-status', name: 'Orange Writer CSS' },
                { href: 'css/groove_display_orange.css', id: 'display-css-status', name: 'Orange Display CSS' },
                { href: 'css/share-button.min.css', id: 'share-css-status', name: 'Share Button CSS' }
            ];
            
            let allLoaded = true;
            
            for (const css of cssFiles) {
                const loaded = await checkCSSFile(css.href, css.id, css.name);
                if (!loaded) allLoaded = false;
            }
            
            if (allLoaded) {
                updateStatus('✓ All CSS files loaded successfully!', false, true);
            } else {
                updateStatus('✗ Some CSS files failed to load', true);
            }
        }

        function checkIntegrityErrors() {
            updateStatus('Checking for integrity errors...');
            
            if (integrityErrors.length === 0) {
                updateStatus('✓ No integrity errors detected!', false, true);
            } else {
                updateStatus(`✗ ${integrityErrors.length} integrity errors found:\n${integrityErrors.join('\n')}`, true);
            }
        }

        function checkFontAwesome() {
            const testElement = document.createElement('i');
            testElement.className = 'fa fa-times';
            testElement.style.position = 'absolute';
            testElement.style.left = '-9999px';
            document.body.appendChild(testElement);
            
            const computedStyle = window.getComputedStyle(testElement, ':before');
            const content = computedStyle.getPropertyValue('content');
            
            document.body.removeChild(testElement);
            
            const iconStatus = document.getElementById('icon-status');
            
            if (content && content !== 'none' && content !== '""') {
                iconStatus.textContent = '✓ Font Awesome icons are working correctly!';
                iconStatus.className = 'status success';
            } else {
                iconStatus.textContent = '✗ Font Awesome icons are not loading properly';
                iconStatus.className = 'status error';
            }
        }

        // Run checks when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkAllCSS();
                checkFontAwesome();
            }, 500);
        });
    </script>
</body>
</html>
